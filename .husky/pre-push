#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "Running pre-push hook..."

# Run a full TypeScript check
echo "Running TypeScript check..."
npx tsc --noEmit
exitCode=$?
if [ $exitCode -ne 0 ]; then
  echo "TypeScript check failed. Push aborted."
  exit $exitCode
fi

# Run a full ESLint check
echo "Running ESLint check..."
npx next lint
exitCode=$?
if [ $exitCode -ne 0 ]; then
  echo "ESLint check failed. Push aborted."
  exit $exitCode
fi

# Run a build verification (without linting since we just did that)
echo "Running build verification..."
npx next build --no-lint
exitCode=$?
if [ $exitCode -ne 0 ]; then
  echo "Build verification failed. Push aborted."
  exit $exitCode
fi

# Run a security audit
echo "Running npm audit..."
npm audit
exitCode=$?
if [ $exitCode -gt 2 ]; then
  echo "Critical vulnerabilities found. Push aborted."
  exit $exitCode
fi

echo "Pre-push checks passed."
exit 0 